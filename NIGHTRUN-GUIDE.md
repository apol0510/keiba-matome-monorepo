# keiba-matome-monorepo: 夜間タスク実行ガイド

このファイルは、夜間の長時間タスク実行（SEO最適化、コメント品質分析等）の詳細ガイドです。

**注**: 
- 日常的な運用情報は `CLAUDE.md` を参照
- 作業履歴は `HISTORY.md` を参照

---

## 夜間長時間タスク実行ガイド

### 概要

Claude Codeを夜間に8-10時間実行することで、運用改善・収益基盤強化が可能です。

**VPS不要**: ローカルMacで実行（追加コスト: 電気代¥30/晩のみ）

### 実行環境セットアップ

```bash
# スリープ防止設定（必須）
caffeinate -d &

# 確認
ps aux | grep caffeinate
```

### 実行可能タスク一覧

#### 🎯 フェーズ1: 無料タスク（優先度S）

**所要時間**: 8-10時間
**追加コスト**: ¥0（電気代¥30のみ）
**期待効果**: 運用工数90%削減、バグ80%削減

| # | タスク名 | 概要 | 恩恵 |
|---|---------|------|------|
| 1 | スクレイピング安定性テスト | 各ソースに100回アクセステスト、成功率測定 | 記事取得成功率 95% → 99.5% |
| 2 | 共通化・リファクタリング | 3プロジェクトの重複コード抽出、packages/sharedに移動 | バグ修正1箇所で済む、新機能追加3倍速 |
| 3 | エラー監視システム実装 | GitHub Actions失敗時の通知、自動リトライ | 手動確認時間90%削減（10分→1分/日） |
| 4 | テスト追加 | スクレイピング＋コメント生成のユニット/E2Eテスト | 本番バグ80%削減 |
| 5 | バックアップ機能実装 | Airtableデータの定期バックアップ、復旧スクリプト | ダウンタイム0時間、データ消失リスク解消 |

#### 💰 フェーズ2: 少額投資タスク（優先度A）

**所要時間**: 8-10時間
**追加コスト**: ¥1,500
**期待効果**: トラフィック+30-50%

| # | タスク名 | 概要 | コスト | 恩恵 |
|---|---------|------|--------|------|
| 6 | SEO大規模最適化 | 全ページのメタデータ、sitemap.xml、構造化データ生成 | ¥700 | Google流入+30-50% |
| 7 | 新ニュースソース追加 | 重賞予想コラム等のスクレイピング追加 | ¥500 | コンテンツ量2-3倍 |
| 8 | 予想精度分析ダッシュボード | nankan-analytics的中率可視化 | ¥300 | CVR+10-20% |

#### 🔍 フェーズ3: 品質改善タスク（優先度B）

**所要時間**: 6-8時間
**追加コスト**: ¥2,000
**期待効果**: ファネル効率2倍

| # | タスク名 | 概要 | コスト | 恩恵 |
|---|---------|------|--------|------|
| 9 | コメント生成品質大規模検証 | 過去200記事再生成、不自然コメント検出、南関導線最適化 | ¥2,000 | 滞在時間+20-30%、遷移率+15-25% |

### 推奨実行順序

#### 第1夜（今晩）: フェーズ1全実行

```bash
# 実行前準備
caffeinate -d &

# Claude Codeで実行:
「以下のタスクを順番に実行してください:

1. スクレイピング安定性テスト
   - packages/keiba-matome, chihou-keiba-matome, yosou-keiba-matomeの全スクレイピングスクリプトを特定
   - 各ソースに対して100回実行テスト
   - 成功率・エラーパターン・タイムアウト発生率を測定
   - 改善提案をレポート

2. 共通化・リファクタリング
   - 3プロジェクトの重複コード（スクレイピング、エラーハンドリング等）を抽出
   - packages/shared/に共通ユーティリティとして移動
   - 各プロジェクトから参照するよう修正
   - 動作確認

3. エラー監視システム実装
   - GitHub Actions失敗検知スクリプト作成
   - Slack/Discord Webhook通知機能実装
   - スクレイピング失敗時の自動リトライ機構
   - ログ集約ダッシュボード（簡易版）

4. テスト追加
   - スクレイピング関数のユニットテスト（Jest使用）
   - コメント生成のE2Eテスト
   - モックデータでの動作確認
   - GitHub Actionsワークフローの検証

5. バックアップ機能実装
   - 全AirtableベースのデータをJSON形式でエクスポート
   - 復旧スクリプト作成（JSON → Airtable書き戻し）
   - 定期実行設定（GitHub Actions or cronジョブ）
   - バックアップファイルのバージョン管理

明日の朝6時までに完了し、詳細レポートを作成してください。」
```

#### 第2夜: フェーズ2実行

#### 第3夜: フェーズ3実行

### コスト試算

#### 既存の月間運用コスト

```
GitHub Actions: 無料枠内（月2,000分、現在1,530分使用）
Netlify: 無料枠内（月100GB転送）
Claude API: 約¥20,000/月（66記事/日 × 30日）
Airtable: 既存契約
X API: 無料

月間合計: 約¥20,000
```

#### 夜間タスク実行の追加コスト

```
フェーズ1（無料タスク）: ¥0
フェーズ2（SEO等）: ¥1,500
フェーズ3（品質改善）: ¥2,000

3夜合計: ¥3,500
```

#### ROI試算

```
投資: ¥3,500（3晩分）

効果（3ヶ月後）:
- トラフィック: +50%
- 運用工数: -80%（月5-10時間削減 = 人件費¥10,000-20,000削減）
- ファネル効率: 2倍（nankan-analytics誘導数2倍）

ROI: 超高（収益3倍の土台 ÷ ¥3,500）
```

### 注意事項

#### 実行環境

- **Mac起動**: 8-10時間スリープさせない（caffeinate使用）
- **電源接続**: バッテリー切れ防止
- **ネットワーク**: 安定したWi-Fi/有線接続

#### Claude API使用量

- フェーズ1: API使用なし → ¥0
- フェーズ2: メタデータ生成等 → ¥1,500
- フェーズ3: 大量コメント再生成 → ¥2,000

#### 実行中の注意

- 途中でAskUserQuestionが発生する可能性あり
- 重要な判断が必要な場合は停止して朝に確認
- エラー発生時は自動的にスキップして次のタスクへ

### トラブルシューティング

#### Macがスリープしてしまう

```bash
# caffeinate再実行
caffeinate -d &

# システム設定でスリープを無効化
# システム環境設定 → バッテリー → 自動スリープをオフ
```

#### Claude API レート制限

```
429 Too Many Requests発生時:
- 自動的に待機してリトライ
- タスク完了まで時間が延びる可能性あり
```

#### GitHub Actions無料枠超過

```
フェーズ1-3はローカル実行のため影響なし
既存の自動化（1日3回）は継続可能
```

### 実行後の確認事項

#### 翌朝チェックリスト

- [ ] Claude Codeの実行ログ確認
- [ ] 各タスクの完了レポート確認
- [ ] 生成されたファイル（テスト、バックアップ等）の検証
- [ ] エラー監視システムの動作確認
- [ ] リファクタリング後のビルドテスト（`npm run build:all`）

#### 効果測定（1週間後）

- [ ] スクレイピング成功率の向上確認
- [ ] GitHub Actions実行ログのエラー減少確認
- [ ] 運用工数の削減実感
- [ ] コードベースの保守性向上確認

#### 効果測定（1-3ヶ月後）

- [ ] Google Analyticsでトラフィック推移確認（フェーズ2実行時）
- [ ] ファネル分析（keiba-matome → chihou-keiba-matome → nankan-analytics）
- [ ] 収益指標の変化

---

