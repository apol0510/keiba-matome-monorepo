name: Fix Japanese Slugs (ä¸€æ™‚å®Ÿè¡Œç”¨)

on:
  workflow_dispatch:
    inputs:
      project:
        description: 'ä¿®æ­£å¯¾è±¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ'
        required: true
        type: choice
        options:
          - chihou-keiba-matome
          - keiba-matome
          - yosou-keiba-matome
          - all
      dry_run:
        description: 'Dry Runï¼ˆç¢ºèªã®ã¿ã€å®Ÿéš›ã«ã¯æ›´æ–°ã—ãªã„ï¼‰'
        required: false
        type: boolean
        default: true

jobs:
  fix-slugs:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: |
          npm install

      - name: Fix Japanese Slugs (chihou-keiba-matome)
        if: inputs.project == 'chihou-keiba-matome' || inputs.project == 'all'
        env:
          AIRTABLE_API_KEY: ${{ secrets.AIRTABLE_API_KEY }}
        run: |
          if [ "${{ inputs.dry_run }}" == "true" ]; then
            echo "ðŸ” Dry Run: chihou-keiba-matome"
            node packages/shared/scripts/fix-japanese-slugs.cjs --project=chihou-keiba-matome --dry-run
          else
            echo "ðŸš€ å®Ÿè¡Œ: chihou-keiba-matome"
            node packages/shared/scripts/fix-japanese-slugs.cjs --project=chihou-keiba-matome --auto
          fi

      - name: Fix Japanese Slugs (keiba-matome)
        if: inputs.project == 'keiba-matome' || inputs.project == 'all'
        env:
          AIRTABLE_API_KEY: ${{ secrets.AIRTABLE_API_KEY }}
        run: |
          if [ "${{ inputs.dry_run }}" == "true" ]; then
            echo "ðŸ” Dry Run: keiba-matome"
            node packages/shared/scripts/fix-japanese-slugs.cjs --project=keiba-matome --dry-run
          else
            echo "ðŸš€ å®Ÿè¡Œ: keiba-matome"
            node packages/shared/scripts/fix-japanese-slugs.cjs --project=keiba-matome --auto
          fi

      - name: Fix Japanese Slugs (yosou-keiba-matome)
        if: inputs.project == 'yosou-keiba-matome' || inputs.project == 'all'
        env:
          AIRTABLE_API_KEY: ${{ secrets.AIRTABLE_API_KEY }}
        run: |
          if [ "${{ inputs.dry_run }}" == "true" ]; then
            echo "ðŸ” Dry Run: yosou-keiba-matome"
            node packages/shared/scripts/fix-japanese-slugs.cjs --project=yosou-keiba-matome --dry-run
          else
            echo "ðŸš€ å®Ÿè¡Œ: yosou-keiba-matome"
            node packages/shared/scripts/fix-japanese-slugs.cjs --project=yosou-keiba-matome --auto
          fi

      - name: å®Ÿè¡Œçµæžœã‚µãƒžãƒªãƒ¼
        run: |
          echo "## Slugä¿®æ­£å®Œäº†" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ: ${{ inputs.project }}" >> $GITHUB_STEP_SUMMARY
          echo "- Dry Run: ${{ inputs.dry_run }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          if [ "${{ inputs.dry_run }}" == "true" ]; then
            echo "âš ï¸ Dry Runãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œã—ã¾ã—ãŸï¼ˆå®Ÿéš›ã«ã¯æ›´æ–°ã—ã¦ã„ã¾ã›ã‚“ï¼‰" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "å®Ÿéš›ã«ä¿®æ­£ã™ã‚‹å ´åˆã¯ã€Dry Runã‚’falseã«ã—ã¦å†å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚" >> $GITHUB_STEP_SUMMARY
          else
            echo "âœ… å®Ÿéš›ã«Slugã‚’æ›´æ–°ã—ã¾ã—ãŸ" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:" >> $GITHUB_STEP_SUMMARY
            echo "1. sitemap.xmlã‚’å†ç”Ÿæˆ" >> $GITHUB_STEP_SUMMARY
            echo "2. ãƒ‡ãƒ—ãƒ­ã‚¤" >> $GITHUB_STEP_SUMMARY
            echo "3. Google Search Consoleã§ã‚µã‚¤ãƒˆãƒžãƒƒãƒ—å†é€ä¿¡" >> $GITHUB_STEP_SUMMARY
          fi
