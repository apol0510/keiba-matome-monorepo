# Netlifyç›£è¦–ã‚¹ãƒ†ãƒƒãƒ—ã®è¿½åŠ ä¾‹
# æ—¢å­˜ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’è¿½åŠ ã—ã¦ãã ã•ã„

      # ========================================
      # Netlifyãƒ‡ãƒ—ãƒ­ã‚¤ç›£è¦–ï¼ˆè¿½åŠ éƒ¨åˆ†ï¼‰
      # ========================================

      - name: Trigger Netlify Build Hook
        if: success()
        env:
          NETLIFY_BUILD_HOOK: ${{ secrets.KEIBA_MATOME_NETLIFY_BUILD_HOOK }}
        run: |
          if [ -n "$NETLIFY_BUILD_HOOK" ]; then
            echo "ğŸš€ Netlifyã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ãƒˆãƒªã‚¬ãƒ¼ä¸­..."
            curl -sS -X POST -H "Content-Type: application/json" -d '{}' "$NETLIFY_BUILD_HOOK"
            echo "âœ… ãƒ‡ãƒ—ãƒ­ã‚¤ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡å®Œäº†"
          else
            echo "â­ï¸  NETLIFY_BUILD_HOOKæœªè¨­å®šã®ãŸã‚ã‚¹ã‚­ãƒƒãƒ—"
          fi

      - name: Monitor Netlify Deploy Status
        if: success()
        env:
          SITE_NAME: "keiba-matome"  # ã¾ãŸã¯ chihou-keiba-matome, yosou-keiba-matome
          NETLIFY_SITE_ID: ${{ secrets.KEIBA_MATOME_SITE_ID }}
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          node packages/shared/scripts/monitor-netlify-deploy.cjs

      # ========================================
      # æ—¢å­˜ã®é€šçŸ¥ã‚¹ãƒ†ãƒƒãƒ—
      # ========================================

      - name: Notify on success
        if: success()
        run: |
          echo "âœ… ã€ä¸­å¤®ç«¶é¦¬ã€‘2ché¢¨ãƒ‹ãƒ¥ãƒ¼ã‚¹ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ"
          echo "è¨˜äº‹æ•°: ${{ github.event.inputs.article_count || '3' }}"
          echo "ğŸ¦ XæŠ•ç¨¿: æœ€å¤§3ä»¶æŠ•ç¨¿æ¸ˆã¿"
          echo "ğŸŒ Netlifyãƒ‡ãƒ—ãƒ­ã‚¤: ç›£è¦–ä¸­..."

      - name: Notify on failure
        if: failure()
        run: |
          echo "âŒ ã€ä¸­å¤®ç«¶é¦¬ã€‘ãƒ‹ãƒ¥ãƒ¼ã‚¹ç”Ÿæˆã¾ãŸã¯ãƒ‡ãƒ—ãƒ­ã‚¤ã«å¤±æ•—ã—ã¾ã—ãŸ"
          exit 1
